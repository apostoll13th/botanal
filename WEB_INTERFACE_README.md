# Веб-интерфейс для Telegram бота учета финансов

## Описание

Веб-интерфейс предоставляет удобный доступ к статистике расходов через браузер. Включает в себя:
- Визуализацию расходов (круговые диаграммы и графики)
- Таблицы с фильтрацией
- Отслеживание бюджетов и целей
- Адаптивный дизайн для мобильных устройств

## Структура проекта

```
telega_bot/
├── backend/           # Flask API сервер
│   ├── app.py        # Основной файл API
│   └── requirements.txt
├── frontend/          # Веб-интерфейс
│   ├── index.html    # Главная страница
│   ├── app.js        # JavaScript логика
│   └── styles.css    # Стили
└── expenses.db       # Общая база данных
```

## Быстрый запуск

### 1. Запуск Backend (Flask API)

```bash
# Переход в директорию backend
cd backend

# Создание виртуального окружения (рекомендуется)
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate     # Windows

# Установка зависимостей
pip install -r requirements.txt

# Запуск сервера
python app.py
```

API будет доступен по адресу: http://localhost:5000

### 2. Запуск Frontend

Для запуска фронтенда можно использовать любой HTTP сервер. Несколько вариантов:

#### Вариант 1: Python HTTP Server (рекомендуется)
```bash
cd frontend
python3 -m http.server 3000
```

#### Вариант 2: Node.js http-server
```bash
# Установка http-server глобально
npm install -g http-server

# Запуск
cd frontend
http-server -p 3000
```

#### Вариант 3: Live Server в VS Code
Установите расширение "Live Server" и запустите через контекстное меню на index.html

Веб-интерфейс будет доступен по адресу: http://localhost:3000

### 3. Использование

1. Запустите Telegram бота (если еще не запущен):
   ```bash
   python bot.py
   ```

2. В Telegram боте:
   - Используйте команду `/start` - появится кнопка "Открыть личный кабинет"
   - Или используйте команду `/web` для быстрого доступа

3. Нажмите на кнопку - откроется веб-интерфейс с вашей статистикой

## API Эндпоинты

- `GET /api/health` - проверка работоспособности
- `GET /api/user/<user_id>` - информация о пользователе
- `GET /api/expenses/<user_id>` - список расходов
  - Параметры: `start_date`, `end_date`, `category`
- `GET /api/expenses-summary/<user_id>` - сводка за 30 дней
- `GET /api/budgets/<user_id>` - бюджеты пользователя
- `GET /api/goals/<user_id>` - цели накоплений

## Конфигурация

### Изменение портов

Backend (в `backend/app.py`):
```python
app.run(debug=True, host='0.0.0.0', port=5000)  # Измените port
```

Frontend API URL (в `frontend/app.js`):
```javascript
const API_URL = 'http://localhost:5000/api';  // Измените при необходимости
```

### Доступ с других устройств

Для доступа с других устройств в локальной сети:

1. Узнайте IP адрес компьютера:
   ```bash
   # Linux/Mac
   ifconfig
   # Windows
   ipconfig
   ```

2. В боте измените URL в функциях `start` и `web_interface`:
   ```python
   web_url = f"http://YOUR_IP:3000/?user_id={user_id}"
   ```

3. В `frontend/app.js` измените API_URL:
   ```javascript
   const API_URL = 'http://YOUR_IP:5000/api';
   ```

## Возможные проблемы

### CORS ошибки
Если возникают CORS ошибки, убедитесь что Flask API запущен и доступен.

### База данных не найдена
Убедитесь, что `expenses.db` находится в корневой директории проекта (рядом с bot.py).

### Нет данных в интерфейсе
1. Проверьте, что в боте есть данные (добавьте несколько расходов)
2. Убедитесь, что используется правильный user_id
3. Проверьте консоль браузера на наличие ошибок

## Безопасность

⚠️ **Важно**: Текущая реализация предназначена для локального использования. 

Для продакшн-использования необходимо:
1. Добавить аутентификацию (JWT токены или сессии)
2. Использовать HTTPS
3. Ограничить CORS только для вашего домена
4. Добавить валидацию входных данных
5. Использовать переменные окружения для конфигурации

## Расширение функционала

### Добавление новых графиков
1. Добавьте новый эндпоинт в `backend/app.py`
2. Добавьте функцию получения данных в `frontend/app.js`
3. Используйте Chart.js для визуализации

### Экспорт данных
Можно добавить эндпоинты для экспорта в CSV/Excel:
```python
@app.route('/api/export/<int:user_id>', methods=['GET'])
def export_data(user_id):
    # Реализация экспорта
    pass
```

## Скриншоты

После запуска вы увидите:
- **Обзор**: Круговая диаграмма расходов и график динамики
- **Расходы**: Таблица с фильтрацией по датам и категориям
- **Бюджеты**: Прогресс-бары с информацией о лимитах
- **Цели**: Карточки целей с прогрессом накоплений