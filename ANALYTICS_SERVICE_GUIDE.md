# üìä –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–µ—Ä–≤–∏—Å—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (Go API + React UI), –∫–∞–∫ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL –∏ –∫–∞–∫ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –µ–¥–∏–Ω—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü ‚Äî Go backend.

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è | –†–æ–ª—å –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ |
|-----------|-----------------|------------------|
| Go Backend API | `backend-go/main.go`, `backend-go/schema.go` | –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü —Å—Ö–µ–º—ã: —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏, –æ—Ç–¥–∞–µ—Ç REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/*`. |
| Telegram Bot (Python) | `bot.py`, `database.py` | –†–∞–±–æ—Ç–∞–µ—Ç —Å –≥–æ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π: –∂–¥–µ—Ç –ë–î, —á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥, –Ω–æ –Ω–µ –º–∏–≥—Ä–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã. |
| React Frontend (PWA) | `frontend-react/` | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `Overview/Expenses/Budgets/Goals/Expenses` –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Ç–µ–ø–µ—Ä—å –ø–∏—à—É—Ç –∏—Ö —á–µ—Ä–µ–∑ API (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ—Ñ–∏–ª—å). |
| PostgreSQL | `docker-compose.yml` (`db` —Å–µ—Ä–≤–∏—Å) | –•—Ä–∞–Ω–∏—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (`users`, `expenses`, `budgets`, `savings_goals`, `reminders`, `categories`, `migrations`). |

> –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç: **—Ç–æ–ª—å–∫–æ Go backend –≤–ª–∞–¥–µ–µ—Ç —Å—Ö–µ–º–æ–π –ë–î**. –ë–æ—Ç –∏ UI —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–≤–µ—Ä—Ö REST API –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π.

## 2. –ö–∞–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã

1. `backend-go/main.go` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL.
2. `ensureSchema()` –≤ `schema.go` —Å–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (`users`, `expenses`, `budgets`, `savings_goals`, `reminders`, `categories`, `migrations`).
3. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–ø–∏—Å–æ–∫ –≤ `schema.go`):
   - `#1` –¥–æ–±–∞–≤–ª—è–µ—Ç `transaction_type` –≤ `expenses` –∏ backfill'–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º `expense`.
   - `#2` –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ `expenses` –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `categories`.
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ backend —Å—Ç–∞—Ä—Ç—É–µ—Ç HTTP-—Å–µ—Ä–≤–µ—Ä –Ω–∞ `:5000`.
5. `bot.py` –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `wait_for_db()` –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –≥–æ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ (—Ä—É—á–Ω–∞—è)

```bash
docker compose logs backend | grep "Migration"
docker compose exec db psql -U postgres -d expenses -c "\dt"
docker compose exec db psql -U postgres -d expenses -c "SELECT * FROM migrations;"
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `categories`, –∞ `expenses` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–æ–Ω–∫—É `transaction_type`.

## 3. –ü–æ—Ç–æ–∫ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```text
PostgreSQL ‚Üí Go Backend (schema + API) ‚Üí Bot / React UI (—á–∏—Ç–∞—Ç–µ–ª–∏/–∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ REST)
```

`docker-compose.yml` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —á–µ—Ä–µ–∑ `depends_on`, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã:

```bash
cp .env.example .env             # –∑–∞–¥–∞—Ç—å TELEGRAM_BOT_TOKEN –∏ DATABASE_URL
docker compose up --build        # —Å—Ç–∞—Ä—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

–í–Ω—É—Ç—Ä–∏:
- `db` –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç `5432`.
- `backend` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î, —Å–æ–∑–¥–∞–µ—Ç/–º–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–ª—É—à–∞–µ—Ç `:5000`.
- `bot` —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `backend` (—Å–º. `depends_on`) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã.
- `frontend` (Nginx + React) –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `/api` –Ω–∞ `backend` –∏ —Å–ª—É—à–∞–µ—Ç `:8080`.

## 4. –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

1. **–õ–æ–≥–∏**
   ```bash
   docker compose logs -f backend | egrep "schema|Migration"
   docker compose logs -f bot | tail -n 20
   docker compose logs -f frontend | tail -n 20
   ```
2. **API**  
   ```bash
   curl http://localhost:5000/api/health
   curl "http://localhost:5000/api/expenses-summary/123456"
   ```
   –ó–∞–º–µ–Ω–∏—Ç–µ `123456` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π `user_id`.
3. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**  
   `http://localhost:8080?user_id=–í–ê–®_TELEGRAM_ID`

–ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≥—Ä—É–∑—è—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É Network ‚Üí –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/...`.

## 5. –ß—Ç–æ —Å—á–∏—Ç–∞—Ç—å ¬´—Å–µ—Ä–≤–∏—Å–æ–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏¬ª

| –°–ª–æ–π | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å |
|------|------------|--------------|
| –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö | UI/–±–æ—Ç —Å–æ–∑–¥–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∏ —á–µ—Ä–µ–∑ REST (`POST /api/expenses`, `/api/categories`, `/api/users`). | `frontend-react/src/components/Expenses.js`, `backend-go/main.go`. |
| –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö | PostgreSQL + –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ Go (`schema.go`). | –¢–∞–±–ª–∏—Ü—ã `expenses`, `categories`, `budgets`, `savings_goals`. |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (API) | Go —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `getExpenses`, `getExpensesSummary`, `getBudgets`, `getSavingsGoals`. | `backend-go/main.go`. |
| –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è | React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `Overview`, `Expenses`, `Budgets`, `Goals`. | `frontend-react/src/components/*`. |

–í—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã, —Ç–∞–±–ª–∏—Ü—ã –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç—Ä–æ—è—Ç—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, –æ—Ç–¥–∞–≤–∞–µ–º—ã—Ö Go API. –û–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä—è–º–æ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ `–†–∞—Å—Ö–æ–¥—ã` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–∏–ø—ã `expense` –∏ `income`), –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –∏–∑ UI –∏–ª–∏ —á–µ—Ä–µ–∑ REST.

## 6. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ Docker

### Backend API
```bash
export DATABASE_URL="postgresql://postgres:postgres@localhost:5432/expenses?sslmode=disable"
cd backend-go
go run main.go
```

### Frontend
```bash
cd frontend-react
npm install
REACT_APP_API_URL=http://localhost:5000/api npm start
```

–í–∞–∂–Ω–æ: –ø–µ—Ä–µ–¥ —ç—Ç–∏–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ backend (`go run main.go`), –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ–Ω —Å–æ–∑–¥–∞–µ—Ç —Å—Ö–µ–º—ã. –ë–æ—Ç –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ backend –æ—Ç—á–∏—Ç–∞–ª—Å—è "Database schema ready".

## 7. –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

- **API –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç** ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ backend –¥–æ—Å—Ç—É—á–∞–ª—Å—è –¥–æ PostgreSQL (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL`) –∏ —Å–º–æ–≥ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã. –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å `Database schema ready`.
- **–ü—É—Å—Ç—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏** ‚Äî —á–∞—â–µ –≤—Å–µ–≥–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ `expenses` –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é:
  ```bash
  docker compose exec db psql -U postgres -d expenses \
    -c "INSERT INTO expenses (user_id, amount, category, date) VALUES (123456, 100, 'food', CURRENT_DATE);"
  ```
- **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–æ–∫** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend: `docker compose restart backend`. –û–Ω —Å–Ω–æ–≤–∞ –ø—Ä–æ–≥–æ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –¥–æ–±–∞–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è.

## 8. –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã

1. –î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å DDL –≤ `createBaseTables()` –∏–ª–∏ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –≤ `runMigrations()` (`backend-go/schema.go`).
2. –û–±–Ω–æ–≤–∏—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –≤ `backend-go/main.go`, –µ—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –ø–æ–ª—è.
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend: `docker compose restart backend`.
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (API –∫–ª–∏–µ–Ω—Ç + –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã) –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (`README.md`, `DATABASE_ARCHITECTURE.md`).

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-11-10
