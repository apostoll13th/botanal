# üóÑÔ∏è Database Architecture

## Single Source of Truth

### ‚úÖ Go Backend ‚Äì –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü —Å—Ö–µ–º—ã

`backend-go/schema.go` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç PostgreSQL –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ API:

1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `DATABASE_URL`.
2. –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (`users`, `expenses`, `budgets`, `savings_goals`, `reminders`, `categories`, `migrations`).
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫):
   - `#1` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É `transaction_type` –≤ `expenses`.
   - `#2` ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ `expenses` –≤ —Ç–∞–±–ª–∏—Ü—É `categories`.

–í—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ Go –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### ü§ñ Python Bot ‚Äì –∫–ª–∏–µ–Ω—Ç –¥–∞–Ω–Ω—ã—Ö

`bot.py` —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –∂–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã (`wait_for_db()`) –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–æ–π. –ù–∏–∫–∞–∫–∏—Ö `init_db()` –∏ `database_migrations` –≤ –±–æ—Ç–µ –±–æ–ª—å—à–µ –Ω–µ—Ç, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–Ω—É —Ç–æ—á–∫—É –ø—Ä–∞–≤–¥—ã.

## –°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

```yaml
services:
  db:        # PostgreSQL
  backend:   # –°–æ–∑–¥–∞–µ—Ç/–º–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É ‚Üí API
  bot:       # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç backend, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
  frontend:  # PWA –ø–æ–≤–µ—Ä—Ö API
```

`docker-compose.yml` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ backend —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ë–î, –∞ bot –∂–¥–µ—Ç, –ø–æ–∫–∞ backend –ø—Ä–∏–≤–µ–¥–µ—Ç —Å—Ö–µ–º—É –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

## –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                              |
|----------------|-----------------------------------------|
| `users`        | –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (user_id, –∏–º—è)    |
| `app_users`    | –ê–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –≤—Ö–æ–¥–∞ –≤ UI (login/password/role ‚Üî telegram user_id) |
| `expenses`     | –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∫–∞–∫ —Ä–∞—Å—Ö–æ–¥—ã, —Ç–∞–∫ –∏ –¥–æ—Ö–æ–¥—ã)|
| `budgets`      | –ë—é–¥–∂–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º                   |
| `savings_goals`| –¶–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π                         |
| `reminders`    | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è –±–æ—Ç–∞                    |
| `categories`   | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å —Ç–∏–ø–æ–º (expense/income) |
| `app_users`    | –õ–æ–≥–∏–Ω—ã/–ø–∞—Ä–æ–ª–∏/—Ä–æ–ª–∏ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ UI (—Å–≤—è–∑–∞–Ω—ã —Å telegram user_id) |
| `migrations`   | –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π backend'–∞  |

> –ö–æ–ª–æ–Ω–∫–∞ `transaction_type` –≤ `expenses` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —Ä–∞—Å—Ö–æ–¥—ã, —Ç–∞–∫ –∏ –¥–æ—Ö–æ–¥—ã –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ. –í—Å–µ GET-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ–∏–ª—å—Ç—Ä—É—é—Ç `expense`, –Ω–æ UI –º–æ–∂–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å `income` –∏–ª–∏ `all`.

## –†–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –°–æ–∑–¥–∞–Ω–∏–µ/–º–∏–≥—Ä–∞—Ü–∏–∏ | –ß—Ç–µ–Ω–∏–µ | –ó–∞–ø–∏—Å—å |
|--------------------|-------------------|--------|--------|
| **Go Backend**     | ‚úÖ (schema & migrate) | ‚úÖ | ‚úÖ REST (—Ä–∞—Å—Ö–æ–¥—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏) |
| **Telegram Bot**   | ‚ùå                 | ‚úÖ | ‚úÖ (—á–µ—Ä–µ–∑ SQL/–±–æ—Ç-–∫–æ–º–∞–Ω–¥—ã) |
| **React Frontend** | ‚ùå                 | ‚úÖ (—á–µ—Ä–µ–∑ API) | ‚úÖ (POST /api/expenses, /api/categories, /api/users) |

## –ü—Ä–æ–≤–µ—Ä–∫–∏

- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ backend –ø—Ä–∏–º–µ–Ω–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏:
  ```bash
  docker compose logs backend | grep "Migration"
  docker compose exec db psql -U postgres -d expenses -c "SELECT * FROM migrations;"
  ```
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü:
  ```bash
  docker compose exec db psql -U postgres -d expenses -c "\d+ expenses"
  docker compose exec db psql -U postgres -d expenses -c "SELECT * FROM categories;"
  ```
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ / –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å —á–µ—Ä–µ–∑ UI –∏–ª–∏ cURL:
  ```bash
  curl -X POST http://localhost:5000/api/categories -H 'Content-Type: application/json' \
    -d '{"name":"–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏","type":"income"}'
  ```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –î–æ–±–∞–≤—å—Ç–µ `CREATE TABLE`/`ALTER TABLE` –≤ `createBaseTables` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
2. –û–ø–∏—à–∏—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –≤ `runMigrations()` (–Ω–æ–º–µ—Ä + —Ñ—É–Ω–∫—Ü–∏—è).
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ/–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend: `docker compose up --build backend`.
4. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (README, guide) –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –¥–µ—Ä–∂–∏—Ç —Å—Ö–µ–º—É –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, —É–ø—Ä–æ—â–∞–µ—Ç CI/CD –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç UI —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º PWA –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

### –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã

–ú–∏–≥—Ä–∞—Ü–∏—è `#3` –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–≤–µ –∑–∞–ø–∏—Å–∏ –≤ `app_users`:
- `admin / adminStrongPass!` (role: `admin`, `telegram_user_id = 101010`)
- `analyst / analystGo#2024` (role: `analyst`, `telegram_user_id = 202020`)

–ü–æ–º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏/—Å–≤—è–∑–∞–Ω–Ω—ã–µ user_id –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç–µ —ç—Ç–∏ –∑–∞–ø–∏—Å–∏ –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ.
